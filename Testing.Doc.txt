# Author: Ahmed Bouzaffour  2025-12-08

TEST 1: (before encryption)

Goal: to verify that the application can
1. allocate a TUN interface tun0
2. direct the trafic into the tunnel
3. intercept the ip packets from the kernel
4. forward those packets via UDP to a remote endpoint

Client Virtual IP: 10.0.0.1 (tun0)
Target Destination: 8.8.8.8 (Google DNS)
UDP Transport: Localhost (127.0.0.1:55555)

Terminal 1:


bouzaffour@DrBouzaffour:~$ sudo ip route add 8.8.8.8 dev tun0
bouzaffour@DrBouzaffour:~$ ip route get 8.8.8.8
8.8.8.8 dev tun0 src 10.0.0.1 uid 1000
    cache
bouzaffour@DrBouzaffour:~$ ping -c 1 8.8.8.8
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.

--- 8.8.8.8 ping statistics ---
1 packets transmitted, 0 received, 100% packet loss, time 0ms

bouzaffour@DrBouzaffour:~$

Status: Passed
Trafffic for 8.8.8.8 is correctly routed to our viritual interface

Terminal 2:

bouzaffour@DrBouzaffour:~/github/Userspace-Network-Tunnel$ sudo ./bin/vpn
[INFO] attempting to create TUN device...
[SUCCESS] Interface 'tun0' allocated. FD: 3
[INFO] Running command: ip addr add 10.0.0.1/24 dev tun0 && ip link set tun0 up
[INFO] Creating UDP socket...
[INFO] Tunnel is UP. Forwarding packets to 127.0.0.1:55555
[OUT] Forwarded 48 bytes to UDP
[OUT] Forwarded 48 bytes to UDP
[OUT] Forwarded 48 bytes to UDP
[OUT] Forwarded 84 bytes to UDP
[OUT] Forwarded 48 bytes to UDP

Status: Passed
The application reads 84 bytes from the FD

Terminal 3:

bouzaffour@DrBouzaffour:~$ nc -u -l -p 55555 | hexdump -C
00000000  60 00 00 00 00 08 3a ff  fe 80 00 00 00 00 00 00  |`.....:.........|
00000010  3f 78 11 c5 14 5c 28 40  ff 02 00 00 00 00 00 00  |?x...\(@........|
00000020  00 00 00 00 00 00 00 02  85 00 ef 5d 00 00 00 00  |...........]....|
00000030  60 00 00 00 00 08 3a ff  fe 80 00 00 00 00 00 00  |`.....:.........|
00000040  3f 78 11 c5 14 5c 28 40  ff 02 00 00 00 00 00 00  |?x...\(@........|
00000050  00 00 00 00 00 00 00 02  85 00 ef 5d 00 00 00 00  |...........]....|
00000060  60 00 00 00 00 08 3a ff  fe 80 00 00 00 00 00 00  |`.....:.........|
00000070  3f 78 11 c5 14 5c 28 40  ff 02 00 00 00 00 00 00  |?x...\(@........|
00000080  00 00 00 00 00 00 00 02  85 00 ef 5d 00 00 00 00  |...........]....|
00000090  45 00 00 54 5c 60 40 00  40 01 c4 38 0a 00 00 01  |E..T\`@.@..8....|
000000a0  08 08 08 08 08 00 2a 73  18 a7 00 01 15 84 37 69  |......*s......7i|
000000b0  00 00 00 00 a1 24 08 00  00 00 00 00 10 11 12 13  |.....$..........|
000000c0  14 15 16 17 18 19 1a 1b  1c 1d 1e 1f 20 21 22 23  |............ !"#|
000000d0  24 25 26 27 28 29 2a 2b  2c 2d 2e 2f 30 31 32 33  |$%&'()*+,-./0123|
000000e0  34 35 36 37 60 00 00 00  00 08 3a ff fe 80 00 00  |4567`.....:.....|
000000f0  00 00 00 00 3f 78 11 c5  14 5c 28 40 ff 02 00 00  |....?x...\(@....|
00000100  00 00 00 00 00 00 00 00  00 00 00 02 85 00 ef 5d  |...............]|

----
00000090  45 00 00 54 5c 60 40 00  40 01 c4 38 0a 00 00 01  |E..T\`@.@..8....|
000000a0  08 08 08 08 08 00 2a 73  18 a7 00 01 15 84 37 69  |......*s......7i|
----
Total length (00 54) which is 84bytes
Source IP (0a 00 00 01): corresponds to our virtual interface 10.0.0.1
Destination (08 08 08 08): Google DNS 8.8.8.8

Status: Passed
